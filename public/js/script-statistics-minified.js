searchInput="",paths=document.getElementsByTagName("path");var chart,chartData,initialColorOfCounty="?",countyIdtoPathMap=new Map,countyIdtoNameMap=new Map,countyNameToIdMap=new Map,countyIdToColorMap=new Map,listOfSelectedCounties=[],CountyOnClickFunctions=new Array,CountyOnMouseEnterFunctions=new Array,CountyOnMouseLeaveFunctions=new Array,monthNames=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"],categoriesLabels=[["< 25","25 - 29","30 - 39","40 - 49","50 - 55","55 >"],["Male","Female"],["No education","Primary","Middleschool","Highschool","Bachelors","Post highschool","Professional"],["Urban","Rural"],["Compensated","Not compensated"]],theme=THEME_DARK,darkGridColor="#1F1E25",lightGridColor="#EBEBEB";let availableCountyColors=MAIN_COLORS;function setTheme(t){localStorage.setItem("theme",t),document.documentElement.className=t,theme=t,Chart.defaults.global.defaultFontColor=theme==THEME_DARK?lightGridColor:darkGridColor,void 0!==chart&&(chart.setGridColor((theme==THEME_DARK?lightGridColor:darkGridColor)+"22"),chart.getChart().update())}function toggleTheme(){localStorage.getItem("theme")===THEME_DARK?(setTheme(THEME_LIGHT),document.getElementsByClassName("theme-dark-button")[0].style.opacity=0,document.getElementsByClassName("theme-light-button")[0].style.opacity=1):(setTheme(THEME_DARK),document.getElementsByClassName("theme-dark-button")[0].style.opacity=1,document.getElementsByClassName("theme-light-button")[0].style.opacity=0)}function setUX(){setMenu(),setThemeButton(),setCounties(),setMap(),setChart(),setCategorySelector(),setDownloadType(),setRangePicker()}function setSearchCountyInput(){document.getElementsByClassName("search")[0].addEventListener("input",function(t){searchInput=t.target.value,initializeSearchItems()})}function setMenu(){menuBtn=document.getElementsByClassName("menu-button")[0],nav=document.getElementsByClassName("menu")[0],menuBtn.addEventListener("click",function(){nav.classList.add("menu--opened"),menuBtn.classList.add("menu-button--opened")}),document.body.addEventListener("click",function(t){menuBtn.contains(t.target)||nav.contains(t.target)||(nav.classList.remove("menu--opened"),menuBtn.classList.remove("menu-button--opened"))})}function setThemeButton(){document.getElementsByClassName("theme")[0].addEventListener("click",toggleTheme)}function setCounties(){addButton=document.getElementsByClassName("item-add-surface")[0],selectorContainer=document.getElementsByClassName("county-selector-container")[0],selectorItems=document.getElementsByClassName("selector-item"),addButton.addEventListener("click",function(){document.getElementsByClassName("county-add-icon")[0].style.margin="auto 10px",selectorContainer.classList.add("county-selector-container--opened"),initializeSearchItems()}),document.body.addEventListener("click",function(t){addButton.contains(t.target)||selectorContainer.contains(t.target)||(document.getElementsByClassName("county-add-icon")[0].style.margin="auto",selectorContainer.classList.remove("county-selector-container--opened"),document.getElementsByClassName("search")[0].value="",searchInput="")});for(let t=0;t<paths.length;t++){const e=paths[t];e.onclick=onClickCounty,e.onmouseenter=onMouseEnterCounty,e.onmouseleave=onMouseLeaveCounty}}function setMap(){var t=document.getElementsByClassName("map-menu")[0],e=document.getElementsByClassName("map-button")[0];e.addEventListener("click",function(){const t=document.getElementsByClassName("map-menu")[0];e.classList.add("map-button--opened"),e.style.opacity=0,t.classList.add("map-menu--opened")}),document.body.addEventListener("click",function(a){t.contains(a.target)||e.contains(a.target)||(t.classList.remove("map-menu--opened"),document.getElementsByClassName("map-button")[0].style.opacity=1)})}function setChart(){Chart.defaults.global.defaultFontFamily="Ubuntu";var t=document.querySelectorAll(".chart-type-container .item"),e=document.querySelectorAll(".chart-container .chart")[0].getBoundingClientRect(),a=document.querySelectorAll(".chart .chartCanvas")[0],n=a.getContext("2d");a.width=e.width,a.height=e.height,(chartData=new ChartData).setRangeStart(document.getElementById("start").value),chartData.setRangeEnd(document.getElementById("end").value),(chart=MyLineChart(n,MAIN_COLORS,chartData.timeLabels)).setSize(a.width,a.height),chart.setGridColor((theme==THEME_DARK?lightGridColor:darkGridColor)+"22"),t.forEach(e=>{e.addEventListener("click",function(){for(let a=0;a<t.length;a++)t[a]==e?(t[a].classList.add("item--selected"),0==a?changeChartTypeToLine(n):1==a?changeChartTypeToBar(n):2==a&&changeChartTypeToPie(n)):t[a].classList.remove("item--selected")})})}function changeChartTypeToLine(t){chartData.type="line",document.querySelectorAll(".chart-settings-contianer .chart-setting").forEach(t=>t.classList.remove("hidden")),document.querySelectorAll(".chart-settings-contianer .chart-setting.selector-start label")[0].innerText="Start Range:",document.querySelectorAll(".chart-settings-contianer .categories-list input").forEach((t,e)=>{t.checked=0==e,t.removeEventListener("click",chartData.category.multipleItemCheckEvent),t.addEventListener("click",chartData.category.singleItemCheckEvent)}),chart.getChart().destroy(),(chart=MyLineChart(t,MAIN_COLORS,chartData.timeLabels)).setGridColor((theme==THEME_DARK?lightGridColor:darkGridColor)+"22"),updateChart()}function changeChartTypeToBar(t){chartData.type="bar",document.querySelectorAll(".chart-settings-contianer .chart-setting.selector-nd")[0].classList.add("hidden"),document.querySelectorAll(".range-selector #start")[0].max="2021-02",document.querySelectorAll(".chart-settings-contianer .chart-setting.selector-start label")[0].innerText="Month:",document.querySelectorAll(".chart-settings-contianer .categories-list input").forEach(t=>{t.removeEventListener("click",chartData.category.singleItemCheckEvent),t.addEventListener("click",chartData.category.multipleItemCheckEvent)}),chart.getChart().destroy(),(chart=MyBarChart(t,MAIN_COLORS,chartData.countyLabels)).setGridColor((theme==THEME_DARK?lightGridColor:darkGridColor)+"22"),updateChart()}function changeChartTypeToPie(t){chartData.type="pie",document.querySelectorAll(".chart-settings-contianer .chart-setting.selector-end")[0].classList.add("hidden"),document.querySelectorAll(".range-selector #start")[0].max="2021-02",document.querySelectorAll(".chart-settings-contianer .chart-setting.selector-start label")[0].innerText="Month:",document.querySelectorAll(".chart-settings-contianer .categories-list input").forEach(t=>{t.removeEventListener("click",chartData.category.singleItemCheckEvent),t.addEventListener("click",chartData.category.multipleItemCheckEvent)}),chart.getChart().destroy(),(chart=MyPieChart(t,MAIN_COLORS,chartData.timeLabels)).setGridColor((theme==THEME_DARK?lightGridColor:darkGridColor)+"22"),updateChart()}function updateChart(){if(0==chartData.type.localeCompare("line")){let t=chartData.getLines();chart.removeLines(),chartData.countyLabels.forEach((e,a)=>{chart.addLine(e,t[a])}),chart.setLabels(chartData.timeLabels)}else if(0==chartData.type.localeCompare("bar")){let t=chartData.getBars();chart.removeLines(),chartData.category.getSelectedItems().forEach((e,a)=>{chart.addLine(e,t[a])}),chart.setLabels(chartData.countyLabels)}else if(0==chartData.type.localeCompare("pie")){let t=chartData.getPies();chart.removeLines(),chartData.countyLabels.forEach((e,a)=>{chart.addLine(e,t[a])}),chart.setLabels(chartData.category.getSelectedItems())}}function initializeSearchItems(){var t=document.getElementById("counties-selector");for(var e in t.textContent="",countyIdtoNameMap)if(null==chartData.countyLabels.find(function(t){return t===e})){var a=countyIdtoNameMap[e].toLowerCase();a=(a=(a=(a=(a=a.replace(/ș/g,"s")).replace(/ț/g,"t")).replace(/ă/g,"a")).replace(/â/g,"a")).replace(/î/g,"i");var n=searchInput.toLowerCase().trim();if(n=(n=(n=(n=(n=n.replace(/ș/g,"s")).replace(/ț/g,"t")).replace(/ă/g,"a")).replace(/â/g,"a")).replace(/î/g,"i"),0!=searchInput.length&&!a.startsWith(n))continue;const o=document.createElement("div");o.classList.add("selector-item"),o.setAttribute("value",e),o.innerHTML=countyIdtoNameMap[e],o.addEventListener("click",function(){setTimeout(function(){o.parentNode.removeChild(o)},10)});const c=e;o.onclick=function(){addCounty(c)},t.appendChild(o)}}function addCounty(t){changeColorOfCounty(document.getElementById(t))}function removeCounty(t){changeColorOfCounty(document.getElementById(t))}function initializeMaps(){for(var t in countyIdtoNameMap.AB="Alba",countyIdtoNameMap.AG="Argeș",countyIdtoNameMap.AR="Arad",countyIdtoNameMap.BC="Bacău",countyIdtoNameMap.BH="Bihor",countyIdtoNameMap.BN="Bistrița-Năsăud",countyIdtoNameMap.BR="Brăila",countyIdtoNameMap.BT="Botoșani",countyIdtoNameMap.B="București",countyIdtoNameMap.BV="Brașov",countyIdtoNameMap.BZ="Buzău",countyIdtoNameMap.CL="Călărași",countyIdtoNameMap.CS="Caraș-Severin",countyIdtoNameMap.CT="Constanța",countyIdtoNameMap.CV="Covasna",countyIdtoNameMap.DB="Dâmbovița",countyIdtoNameMap.DJ="Dolj",countyIdtoNameMap.GJ="Gorj",countyIdtoNameMap.GL="Galați",countyIdtoNameMap.GR="Giurgiu",countyIdtoNameMap.HD="Hunedoara",countyIdtoNameMap.HR="Harghita",countyIdtoNameMap.IF="Ilfov",countyIdtoNameMap.IL="Ialomița",countyIdtoNameMap.IS="Iași",countyIdtoNameMap.MH="Mehedinți",countyIdtoNameMap.MM="Maramureș",countyIdtoNameMap.MS="Mureș",countyIdtoNameMap.NT="Neamț",countyIdtoNameMap.OT="Olt",countyIdtoNameMap.PH="Prahova",countyIdtoNameMap.SB="Sibiu",countyIdtoNameMap.SJ="Sălaj",countyIdtoNameMap.SM="Satu Mare",countyIdtoNameMap.SV="Suceava",countyIdtoNameMap.TL="Tulcea",countyIdtoNameMap.TM="Timiș",countyIdtoNameMap.TR="Teleorman",countyIdtoNameMap.VL="Vâlcea",countyIdtoNameMap.VN="Vrancea",countyIdtoNameMap.VS="Vaslui",countyIdtoNameMap)countyNameToIdMap[countyIdtoNameMap[t]]=t;for(var t in countyIdtoNameMap)for(let e=0;e<paths.length;e++){const a=paths[e];if(t===a.getAttribute("id")){countyIdtoPathMap[t]=a;break}}for(var t in countyIdtoNameMap)countyIdToColorMap[t]="?"}function addCountyToList(t){chartData.countyLabels.push(t);const e=document.createElement("div");e.classList.add("item"),e.innerHTML=`\n        <span class="county-text">${t}</span>\n        <div class="close-button" onclick = "removeCounty('${t}')"></div>\n        <span class="county-text material-icons">close</span>\n    `;e.style.marginRight;e.style.opacity=0;var a=document.getElementsByClassName("counties-bar")[0];a.insertBefore(e,a.children[1]),setTimeout(function(){e.style.opacity=1},200),addCountyToLineChart(t)}async function addCountyToLineChart(t){var e=chartData.rangeStartYear,a=chartData.rangeStartMonth,n=chartData.rangeEndYear,o=chartData.rangeEndMonth,c=await fetch("/api/query?counties="+t+"&startYear="+e+"&startMonth="+a+"&endYear="+n+"&endMonth="+o),r=await c.json();let s=t.toLowerCase();chartData.countyDataArray[s]=r,updateChart()}function removeCountyFromList(t){var e=document.getElementsByClassName("counties-bar")[0],a=e.getElementsByClassName("item");for(let o=0;o<a.length;o++){const c=a[o];var n=c.getElementsByTagName("span");if(0!=n.length)if(n[0].innerHTML==t){c.style.marginRight="-"+c.offsetWidth+"px",c.style.opacity=0,setTimeout(function(){e.removeChild(c)},250);chartData.countyLabels=chartData.countyLabels.filter(function(e,a,n){return e===t&&a,e!=t}),delete chartData.countyDataArray[t.toLowerCase()],updateChart();break}}}function onClickCounty(t){var e=t.target;for(let t=0;t<CountyOnClickFunctions.length;t++){(0,CountyOnClickFunctions[t])(e)}}function onMouseEnterCounty(t){var e=t.target;for(let t=0;t<CountyOnMouseEnterFunctions.length;t++){(0,CountyOnMouseEnterFunctions[t])(e)}}function onMouseLeaveCounty(t){var e=t.target;for(let t=0;t<CountyOnMouseLeaveFunctions.length;t++){(0,CountyOnMouseLeaveFunctions[t])(e)}}function addCountyFunction(t,e){"onclick"==t&&CountyOnClickFunctions.push(e),"onmouseenter"==t&&CountyOnMouseEnterFunctions.push(e),"onmouseleave"==t&&CountyOnMouseLeaveFunctions.push(e)}function changeColorOfCounty(t){var e=t.id,a=window.getComputedStyle(t).getPropertyValue("fill");if("?"===initialColorOfCounty&&(initialColorOfCounty=a),a==initialColorOfCounty){var n=extractColor();t.style.fill=n,countyIdToColorMap[e]=n,addCountyToList(e)}else availableCountyColors.splice(0,0,a),t.style.fill=initialColorOfCounty,countyIdToColorMap[e]="?",removeCountyFromList(e)}function extractColor(){var t=availableCountyColors[0];return console.log(t),availableCountyColors=availableCountyColors.filter(function(t,e,a){return 0!=e}),t}function setCategorySelector(t){var e=document.querySelectorAll(".chart-settings-contianer .category-selector")[0],a=document.querySelectorAll(".chart-settings-contianer .category-selector .top .text")[0],n=document.querySelectorAll(".category-selector .options-list")[0],o=Array.from(n.children),c=document.querySelectorAll(".chart-settings-contianer .categories-list")[0];e.addEventListener("click",function(t){n.contains(t.target)||(n.classList.add("options-list--opened"),o.forEach(t=>{t.classList.add("option--opened")}))}),document.body.addEventListener("click",function(t){e.contains(t.target)||n.contains(t.target)||n.classList.remove("options-list--opened")}),c.innerHTML="",categoriesLabels[0].forEach((t,e)=>{c.innerHTML+=`<label class="label" for="category${e}">\n                <input id="category${e}" type="checkbox" name="category${e}" value="${t}" checked/>\n                <span>${t}</span>\n            </label>`}),document.querySelectorAll(".chart-settings-contianer .categories-list input").forEach((t,e)=>{t.checked=0==e,t.addEventListener("click",chartData.getItemClickedFunction()),t.addEventListener("click",()=>updateChart())}),chartData.category.categoryLabel=a.innerText.toLowerCase(),chartData.category.updateItems();for(let t=0;t<o.length;t++){const e=o[t];e.addEventListener("click",()=>{a.innerHTML=e.innerHTML,n.classList.remove("options-list--opened"),c.innerHTML="",parent.categoriesLabels[t].forEach((t,e)=>{c.innerHTML+=`\n                    <label class="label" for="category${e}">\n                        <input id="category${e}" type="checkbox" name="category${e}" value="${t}" checked/>\n                        <span>${t}</span>\n                    </label>\n                `}),document.querySelectorAll(".chart-settings-contianer .categories-list input").forEach((t,e)=>{t.checked=0==e,t.addEventListener("click",chartData.getItemClickedFunction()),t.addEventListener("click",()=>updateChart())}),chartData.category.categoryLabel=a.innerText.toLowerCase(),chartData.category.updateItems(),updateChart()})}}function setDownloadType(){var t=document.querySelectorAll(".chart-settings-contianer .download-options .download")[0],e=document.querySelectorAll(".chart-settings-contianer .download-options .option");t.addEventListener("mouseenter",function(){document.querySelectorAll(".chart-settings-contianer .download-options .material-icons")[0].classList.add("material-icons--hover")}),t.addEventListener("mouseleave",function(){document.querySelectorAll(".chart-settings-contianer .download-options .material-icons")[0].classList.remove("material-icons--hover")}),e.forEach(t=>{t.addEventListener("click",function(){var a=Array.from(e).indexOf(t);for(let t=0;t<e.length;t++)e[t].classList.remove("option--selected");e[a].classList.add("option--selected")})})}function setRangePicker(){var t=document.querySelectorAll(".range-selector #start")[0],e=document.querySelectorAll(".range-selector #end")[0];t.addEventListener("change",()=>{e.min=t.value,0==chartData.type.localeCompare("line")?chartData.setRangeStart(t.value):chartData.setRange(t.value),updateChart()}),e.addEventListener("change",()=>{t.max=e.value,chartData.setRangeEnd(e.value),updateChart()})}window.addEventListener("DOMContentLoaded",t=>{setUX(),setAnimation(),initializeMaps(),setSearchCountyInput()}),setTheme(THEME_DARK),addCountyFunction("onclick",changeColorOfCounty);
